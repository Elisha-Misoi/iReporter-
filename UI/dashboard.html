<!doctype html>
<html>
<head>

<title>iReporter</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<link rel="stylesheet" href="css/app.css">
</head>
<body>
    <div>
        <nav class="p-1">
            <div class="container">
                <div class="header-top black">
                    <h1 class="">iReporter</h1>
        
                    <div class="flex header-nav item-center">
                        <a class="black text-normal" href="dashboard.html">Dashboard</a>
                        <a class="black text-normal" href="profile.html">Profile</a>
                        <a class="black text-normal border signup-button box-shadow" href="signup.html">Sign Up</a>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex">
            <div class="w-quarter content-wrap">
                <div class="flex flex-column content-left px-3-md pt-6 tab">
                    <span class="flex flex-wrap pt-2">
                        <a class="font-monseratt grey-light bold tablinks" href="#" ><i class="far fa-flag"></i> &nbsp; Red Flags</a>
                    </span>
                    <span class="flex flex-wrap pt-2 tablinks">
                        <a class="font-monseratt grey-light bold" href="#"><i class="fas fa-hands-helping"></i> &nbsp; Interventions</a>
                    </span>
                </div>
            </div>

            <div id="dash_container" class="w-rem bg-grey-lighter flex flex-column">
                
                <div class="flex justify-end mr-4 mt-2">
                    <a class="black font-monseratt border signup-button box-shadow bg-blue-lighter" href="new_record.html">
                        New Record
                    </a>
                </div>
                
                <!-- <table id="cool_table">
                    <tr class="font-monseratt fs-sm grey-light">
                        <th>ID</th>
                        <th>Title</th>
                        <th>Type</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Created At</th>
                        <th>Created By</th>
                        <th></th>
                    </tr>
                    <tr class="font-monseratt fs-sm grey-light">
                        <td>1</td>
                        <td>Police officer taking bribe</td>
                        <td>RF</td>
                        <td>Mugumoini, Langata</td>
                        <td>Resolved</td>
                        <td>12 Aug 2017</td>
                        <td>James Ndirangu</td>
                        <td>
                            <div class="flex">
                                <span class="px-sm">
                                    <a href="view_record.html"><i class="fas fa-eye"></i></a>
                                </span>
                                <span class="px-sm">
                                    <a href="edit_record.html"><i class="fas fa-edit"></i></a>
                                </span>
                                <span class="px-sm">
                                    <a href="#"><i class="fas fa-trash"></i></a>
                                </span>
                            </div>
                        </td>
                    </tr>
                    <tr class="font-monseratt fs-sm grey-light">
                        <td>2</td>
                        <td>Pot holes in main road</td>
                        <td>IR</td>
                        <td>Kapkwony, Marsabit</td>
                        <td>Rejected</td>
                        <td>07 Jan 2016</td>
                        <td>Augustino Kwa</td>
                        <td>
                            <div class="flex">
                                <span class="px-sm">
                                    <a href="view_record.html"><i class="fas fa-eye"></i></a>
                                </span>
                                <span class="px-sm">
                                    <a href="edit_record.html"><i class="fas fa-edit"></i></a>
                                </span>
                                <span class="px-sm">
                                    <a href="#"><i class="fas fa-trash"></i></a>
                                </span>
                            </div>
                        </td>
                    </tr>
                 
                    <tr>
                        <td colspan="8">
                            <div class="flex space-between w-full">
                                <span class="font-monseratt fs-sm px-3 btn-sm box-shadow"><a href="#">Prev</a></span>
                                <span class="font-monseratt fs-sm px-3 btn-sm box-shadow"><a href="#">Next</a></span>
                            </div>
                        </td>
                    </tr>
                </table>    -->
                
                <div id="showData"></div>
            </div>
        </div>
    </div>
    <script>

        incidentUrl = 'http://127.0.0.1:5000/api/v2/incidents'  
        token = localStorage.getItem('auth_token')
        console.log(token)

        headers =  {
            "Content-Type": "application/json", 
            "Authorization": "Bearer " + token 
        }

        payload = {
            headers: headers,
            method: 'get'
        }
       
        // request = new Request(incidentUrl, {
        //     method: 'get',
        //     headers: headers
        // })

        fetch(incidentUrl, payload)
        .then(response => {
            if (!response.ok) {
                throw Error(response.statusText)
            }

            return response
        })
        .then(response => response.json())
        .then(data => {
            console.log(data)

            var col = [];
            for (var i = 0; i < data.data.length; i++) {
                for (var key in data.data[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                        console.log(key)
                    }
                }
            }
            col.push(' ')

            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");

            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
            var tr = table.insertRow(-1);                   // TABLE ROW.
            tr.classList.add("font-monseratt", "fs-sm", "grey-light")

            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

            // ADD JSON DATA TO THE TABLE AS ROWS.
            for (var i = 0; i < data.data.length; i++) {

                tr = table.insertRow(-1);
                tr.classList.add("font-monseratt", "fs-sm", "grey-light")

                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);

                    if (j == col.length - 1) {
                        tabCell.innerHTML = '<div class="flex"><span class="px-sm"><a href="view_record.html"><i class="fas fa-eye"></i></a></span><span class="px-sm"><a href="edit_record.html"><i class="fas fa-edit"></i></a></span><span class="px-sm"><a href="#"><i class="fas fa-trash"></i></a></span></div>'
                        continue
                    }

                    if (col[j] == 'location') {
                        tabCell.innerHTML = data.data[i][col[j]].lat
                        continue
                    }

                    tabCell.innerHTML = data.data[i][col[j]];
                }
            }

            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
            var divContainer = document.getElementById("showData");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);

        }).catch(error => {
            console.log(error)
        })

    function htmlToElement(html) {
        var template = document.createElement('template');
        html = html.trim(); // Never return a text node of whitespace as the result
        template.innerHTML = html;
        return template.content.firstChild;
    }
</script>
</body>
</html>